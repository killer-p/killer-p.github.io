<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="@[toc] 一、效果展示[video(video-1Vu774ee-1643158279760)(type-bilibili)(url-https:&#x2F;&#x2F;player.bilibili.com&#x2F;player.html?aid&#x3D;808427731)(image-https:&#x2F;&#x2F;img-blog.csdnimg.cn&#x2F;img_convert&#x2F;7fb15a630bcd5bd3a9b5479cab1502">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2025/06/01/killer-blog/OpenHarmony/bear_micro_LED/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="@[toc] 一、效果展示[video(video-1Vu774ee-1643158279760)(type-bilibili)(url-https:&#x2F;&#x2F;player.bilibili.com&#x2F;player.html?aid&#x3D;808427731)(image-https:&#x2F;&#x2F;img-blog.csdnimg.cn&#x2F;img_convert&#x2F;7fb15a630bcd5bd3a9b5479cab1502">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-06-01T00:23:34.669Z">
<meta property="article:modified_time" content="2025-06-01T00:23:34.669Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-killer-blog/OpenHarmony/bear_micro_LED" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/01/killer-blog/OpenHarmony/bear_micro_LED/" class="article-date">
  <time class="dt-published" datetime="2025-06-01T00:23:34.669Z" itemprop="datePublished">2025-06-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>@[toc]</p>
<h2 id="一、效果展示"><a href="#一、效果展示" class="headerlink" title="一、效果展示"></a>一、效果展示</h2><p>[video(video-1Vu774ee-1643158279760)(type-bilibili)(url-<a target="_blank" rel="noopener" href="https://player.bilibili.com/player.html?aid=808427731)(image-https://img-blog.csdnimg.cn/img_convert/7fb15a630bcd5bd3a9b5479cab150272.png)">https://player.bilibili.com/player.html?aid=808427731)(image-https://img-blog.csdnimg.cn/img_convert/7fb15a630bcd5bd3a9b5479cab150272.png)</a>(title-小熊派micro OpenHarmony3.0 鸿蒙LED应用)]</p>
<h2 id="二、led控制程序"><a href="#二、led控制程序" class="headerlink" title="二、led控制程序"></a>二、led控制程序</h2><p>本文按照小熊派官方的开发指南完成led应用程序开发，在开发指南的基础上添加一些自己的理解。</p>
<p>LED驱动虽然简单，但能帮助新手快速熟悉OpenHarmony HDF的开发框架，是非常适合新手学习实践的项目。</p>
<p>本文实现一个LED的开关控制的APP，所涉及的内容包括</p>
<ul>
<li>led驱动程序</li>
<li>C应用程序</li>
<li>JS应用程序</li>
</ul>
<h3 id="2-1、led驱动程序"><a href="#2-1、led驱动程序" class="headerlink" title="2.1、led驱动程序"></a>2.1、led驱动程序</h3><p>使用HDF框架进行驱动开发，分两个部分：驱动程序，驱动配置。</p>
<h4 id="2-1-1、驱动程序"><a href="#2-1-1、驱动程序" class="headerlink" title="2.1.1、驱动程序"></a>2.1.1、驱动程序</h4><p>驱动程序的代码在&#x2F;device&#x2F;st&#x2F;driver&#x2F;led&#x2F;led.c</p>
<p>其主要是定义驱动程序入口函数，在HDF加载时读取配置信息并初始化GPIO，定义dispatch函数，用于处理与用户层的交互逻辑。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;hdf_device_desc.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;hdf_log.h&quot;</span>         </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;device_resource_if.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;osal_io.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;osal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;osal_mem.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;gpio_if.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HDF_LOG_TAG led_driver</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED_WRITE_READ 1</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">LedOps</span> &#123;</span></span><br><span class="line">    LED_OFF,</span><br><span class="line">    LED_ON,  </span><br><span class="line">    LED_TOGGLE,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Stm32Mp1ILed</span> &#123;</span></span><br><span class="line">    <span class="type">uint32_t</span> gpioNum;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">Stm32Mp1ILed</span> <span class="title">g_Stm32Mp1ILed</span>;</span></span><br><span class="line"><span class="type">uint8_t</span> status = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 读取驱动私有配置（设备树）</span></span><br><span class="line"><span class="type">static</span> <span class="type">int32_t</span> <span class="title function_">Stm32LedReadDrs</span><span class="params">(<span class="keyword">struct</span> Stm32Mp1ILed *led, <span class="type">const</span> <span class="keyword">struct</span> DeviceResourceNode *node)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int32_t</span> ret;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">DeviceResourceIface</span> *<span class="title">drsOps</span> =</span> <span class="literal">NULL</span>;</span><br><span class="line">	</span><br><span class="line">    drsOps = DeviceResourceGetIfaceInstance(HDF_CONFIG_SOURCE);</span><br><span class="line">    <span class="keyword">if</span> (drsOps == <span class="literal">NULL</span> || drsOps-&gt;GetUint32 == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        HDF_LOGE(<span class="string">&quot;%s: invalid drs ops!&quot;</span>, __func__);</span><br><span class="line">        <span class="keyword">return</span> HDF_FAILURE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 读取led.hcs里面led_gpio_num的值 */</span></span><br><span class="line">    ret = drsOps-&gt;GetUint32(node, <span class="string">&quot;led_gpio_num&quot;</span>, &amp;led-&gt;gpioNum, <span class="number">0</span>); </span><br><span class="line">    <span class="keyword">if</span> (ret != HDF_SUCCESS) &#123;</span><br><span class="line">        HDF_LOGE(<span class="string">&quot;%s: read led gpio num fail!&quot;</span>, __func__);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> HDF_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Dispatch是对外提供的服务，用来处理用户态发下来的消息，同时返回数据</span></span><br><span class="line"><span class="type">int32_t</span> <span class="title function_">LedDriverDispatch</span><span class="params">(<span class="keyword">struct</span> HdfDeviceIoClient *client, <span class="type">int</span> cmdCode, <span class="keyword">struct</span> HdfSBuf *data, <span class="keyword">struct</span> HdfSBuf *reply)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint8_t</span> contrl;</span><br><span class="line">    HDF_LOGE(<span class="string">&quot;Led driver dispatch&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (client == <span class="literal">NULL</span> || client-&gt;device == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        HDF_LOGE(<span class="string">&quot;Led driver device is NULL&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> HDF_ERR_INVALID_OBJECT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (cmdCode)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">/* 接收到用户态发来的LED_WRITE_READ命令 */</span></span><br><span class="line">    <span class="keyword">case</span> LED_WRITE_READ:</span><br><span class="line">        <span class="comment">/* 读取data里的数据，赋值给contrl */</span></span><br><span class="line">        HdfSbufReadUint8(data,&amp;contrl);                  </span><br><span class="line">        <span class="keyword">switch</span> (contrl)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="comment">/* 开灯 */</span></span><br><span class="line">        <span class="keyword">case</span> LED_ON:                                            </span><br><span class="line">            GpioWrite(g_Stm32Mp1ILed.gpioNum, GPIO_VAL_LOW);</span><br><span class="line">            status = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">/* 关灯 */</span></span><br><span class="line">        <span class="keyword">case</span> LED_OFF:                                           </span><br><span class="line">            GpioWrite(g_Stm32Mp1ILed.gpioNum, GPIO_VAL_HIGH);</span><br><span class="line">            status = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">/* 状态翻转 */</span></span><br><span class="line">        <span class="keyword">case</span> LED_TOGGLE:</span><br><span class="line">            <span class="keyword">if</span>(status == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                GpioWrite(g_Stm32Mp1ILed.gpioNum, GPIO_VAL_LOW);</span><br><span class="line">                status = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                GpioWrite(g_Stm32Mp1ILed.gpioNum, GPIO_VAL_HIGH);</span><br><span class="line">                status = <span class="number">0</span>;</span><br><span class="line">            &#125;                                        </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* 把LED的状态值写入reply, 可被带至用户程序 */</span></span><br><span class="line">        <span class="keyword">if</span> (!HdfSbufWriteInt32(reply, status))                </span><br><span class="line">        &#123;</span><br><span class="line">            HDF_LOGE(<span class="string">&quot;replay is fail&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> HDF_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> HDF_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//驱动对外提供的服务能力，将相关的服务接口绑定到HDF框架</span></span><br><span class="line"><span class="type">int32_t</span> <span class="title function_">HdfLedDriverBind</span><span class="params">(<span class="keyword">struct</span> HdfDeviceObject *deviceObject)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (deviceObject == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        HDF_LOGE(<span class="string">&quot;Led driver bind failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> HDF_ERR_INVALID_OBJECT;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//定义对外提供的服务函数</span></span><br><span class="line">    <span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">IDeviceIoService</span> <span class="title">ledDriver</span> =</span> &#123;</span><br><span class="line">        .Dispatch = LedDriverDispatch,</span><br><span class="line">    &#125;;</span><br><span class="line">	<span class="comment">//将服务绑定到驱动</span></span><br><span class="line">    deviceObject-&gt;service = (<span class="keyword">struct</span> IDeviceIoService *)(&amp;ledDriver);</span><br><span class="line">    HDF_LOGD(<span class="string">&quot;Led driver bind success&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> HDF_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 驱动自身业务初始的接口（设置IO口为输出） HDF框架在加载驱动的时候，会将私有配置信息保存在HdfDeviceObject 中的property里面</span></span><br><span class="line"><span class="type">int32_t</span> <span class="title function_">HdfLedDriverInit</span><span class="params">(<span class="keyword">struct</span> HdfDeviceObject *device)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Stm32Mp1ILed</span> *<span class="title">led</span> =</span> &amp;g_Stm32Mp1ILed;</span><br><span class="line">    <span class="type">int32_t</span> ret;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (device == <span class="literal">NULL</span> || device-&gt;property == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        HDF_LOGE(<span class="string">&quot;%s: device or property NULL!&quot;</span>, __func__);</span><br><span class="line">        <span class="keyword">return</span> HDF_ERR_INVALID_OBJECT;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 读取hcs私有属性值，gpio引脚号 */</span></span><br><span class="line">    ret = Stm32LedReadDrs(led, device-&gt;property);</span><br><span class="line">    <span class="keyword">if</span> (ret != HDF_SUCCESS) &#123;</span><br><span class="line">        HDF_LOGE(<span class="string">&quot;%s: get led device resource fail:%d&quot;</span>, __func__, ret);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 将GPIO管脚配置为输出 */</span></span><br><span class="line">    ret = GpioSetDir(led-&gt;gpioNum, GPIO_DIR_OUT);</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        HDF_LOGE(<span class="string">&quot;GpioSerDir: failed, ret %d\n&quot;</span>, ret);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    HDF_LOGD(<span class="string">&quot;Led driver Init success&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> HDF_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 驱动资源释放的接口</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HdfLedDriverRelease</span><span class="params">(<span class="keyword">struct</span> HdfDeviceObject *deviceObject)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (deviceObject == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        HDF_LOGE(<span class="string">&quot;Led driver release failed!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    HDF_LOGD(<span class="string">&quot;Led driver release success&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义驱动入口的对象，必须为HdfDriverEntry（在hdf_device_desc.h中定义）类型的全局变量</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HdfDriverEntry</span> <span class="title">g_ledDriverEntry</span> =</span> &#123;</span><br><span class="line">    .moduleVersion = <span class="number">1</span>,</span><br><span class="line">    .moduleName = <span class="string">&quot;HDF_LED&quot;</span>,	<span class="comment">//必须与device_info.hcs中的字段一样，用于与驱动设备资源匹配</span></span><br><span class="line">    .Bind = HdfLedDriverBind,</span><br><span class="line">    .Init = HdfLedDriverInit,</span><br><span class="line">    .Release = HdfLedDriverRelease,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用HDF_INIT将驱动入口注册到HDF框架中</span></span><br><span class="line">HDF_INIT(g_ledDriverEntry);</span><br></pre></td></tr></table></figure>
<p>在创建完成led.c后，还要把它加入OpenHarmony的构建系统。</p>
<p>在led.c同目录下创建BUILD.gn，内容如下：</p>
<ul>
<li>导入hdf.gni：</li>
<li>定义hdf驱动：驱动的源文件。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import(<span class="string">&quot;//drivers/adapter/khdf/liteos/hdf.gni&quot;</span>)</span><br><span class="line">hdf_driver(<span class="string">&quot;hdf_led&quot;</span>) &#123;</span><br><span class="line">    sources = [</span><br><span class="line">    <span class="string">&quot;led.c&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上层目录的BUILD.gn中的deps中添加”led”目录：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">group(<span class="string">&quot;drivers&quot;</span>) &#123;</span><br><span class="line">  deps = [</span><br><span class="line">    <span class="string">&quot;uart&quot;</span>,</span><br><span class="line">    <span class="string">&quot;iwdg&quot;</span>,</span><br><span class="line">    <span class="string">&quot;i2c&quot;</span>,</span><br><span class="line">    <span class="string">&quot;gpio&quot;</span>,</span><br><span class="line">    <span class="string">&quot;led&quot;</span>,</span><br><span class="line">    <span class="string">&quot;stm32mp1xx_hal&quot;</span>,</span><br><span class="line">    <span class="string">&quot;wifi/driver/hi3881&quot;</span>,</span><br><span class="line">    <span class="string">&quot;wifi/driver:hdf_vendor_wifi&quot;</span>,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-2、驱动配置"><a href="#2-1-2、驱动配置" class="headerlink" title="2.1.2、驱动配置"></a>2.1.2、驱动配置</h4><p>HDF使用HCS文件来描述设备配置信息。驱动配置包含两个部分：</p>
<ul>
<li>HDF框架规定的驱动设备描述：device&#x2F;st&#x2F;bearpi_hm_micro&#x2F;liteos_a&#x2F;hdf_config&#x2F;device_info&#x2F;device_info.hcs</li>
<li>驱动的私有配置信息：device&#x2F;st&#x2F;bearpi_hm_micro&#x2F;liteos_a&#x2F;hdf_config&#x2F;led&#x2F;led_config.hcs</li>
</ul>
<p><strong>HDF所需的驱动设备描述：</strong></p>
<p>这些配置信息是HDF框架所需要的信息。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">   platform :: host &#123;</span><br><span class="line">       hostName = <span class="string">&quot;platform_host&quot;</span>;</span><br><span class="line">       priority = <span class="number">50</span>;</span><br><span class="line">       device_led :: device &#123;			<span class="comment">// led设备节点</span></span><br><span class="line">           device0 :: deviceNode &#123;		<span class="comment">// led驱动的DeviceNode节点</span></span><br><span class="line">               policy = <span class="number">2</span>;				<span class="comment">// policy字段是驱动服务发布的策略，在驱动服务管理章节有详细介绍</span></span><br><span class="line">               priority = <span class="number">10</span>;			<span class="comment">// 驱动启动优先级（0-200），值越大优先级越低，建议默认配100，优先级相同则不保证device的加载顺序</span></span><br><span class="line">               preload = <span class="number">1</span>;			<span class="comment">// 驱动按需加载字段</span></span><br><span class="line">permission = <span class="number">0777</span>;		<span class="comment">// 驱动创建设备节点权限</span></span><br><span class="line">               moduleName = <span class="string">&quot;HDF_LED&quot;</span>;	<span class="comment">// 驱动名称，该字段的值必须和驱动入口结构的moduleName相等</span></span><br><span class="line">               serviceName = <span class="string">&quot;hdf_led&quot;</span>;		<span class="comment">// 驱动对外发布服务的名称，必须唯一</span></span><br><span class="line">               deviceMatchAttr = <span class="string">&quot;st_stm32mp157_led&quot;</span>;		<span class="comment">// 驱动私有数据匹配的关键字，必须和驱动私有数据配置表中的match_attr值相等</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p><strong>私有配置信息：</strong></p>
<p>私有配置信息是可选的，在这里我们保存着led对应的gpio管脚号。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root &#123;</span><br><span class="line">    LedDriverConfig &#123;</span><br><span class="line">        led_gpio_num = <span class="number">13</span>;					<span class="comment">//gpio管脚号</span></span><br><span class="line">        match_attr = <span class="string">&quot;st_stm32mp157_led&quot;</span>;   <span class="comment">//该字段的值必须和device_info.hcs中的deviceMatchAttr值一致</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2、C应用程序"><a href="#2-2、C应用程序" class="headerlink" title="2.2、C应用程序"></a>2.2、C应用程序</h3><p>驱动程序已经完成了，现在来编写应用程序。</p>
<p>应用程序做的是：绑定hdf驱动提供的服务（通过”hdf_led”，定义在device_info.hcs）并调用dispatch函数与驱动程序通信。通过0、1、2命令来使驱动程序输出高低电平。</p>
<p>需要注意的是应用程序不能直接读写驱动程序的变量、需要通过<code>HdfSBufObtainDefaultSize()</code>来申请内存，通过这个特殊的内存地址来跟驱动通信。</p>
<p>applications\BearPi\BearPi-HM_Micro\samples\my_led_app\my_led_app.c：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;hdf_sbuf.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;hdf_io_service_if.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED_WRITE_READ 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED_SERVICE <span class="string">&quot;hdf_led&quot;</span> 	<span class="comment">//这里和hdf.hcs里的节点属性一样</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">SendEvent</span><span class="params">(<span class="keyword">struct</span> HdfIoService *service,<span class="type">uint8_t</span> data)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//使用HdfSBufObtainDefaultSize申请内存，这种类型的内存才能用于和驱动程序交换数据</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">HdfSBuf</span> *<span class="title">send_buf</span> =</span> HdfSBufObtainDefaultSize();</span><br><span class="line">	<span class="keyword">if</span>(send_buf == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;send_buf fail\r\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">HdfSBuf</span> *<span class="title">reply</span> =</span> HdfSBufObtainDefaultSize();</span><br><span class="line">	<span class="keyword">if</span>(reply == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;reply fail\r\n&quot;</span>);</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//将数据写入send_buf</span></span><br><span class="line">	<span class="keyword">if</span> (!HdfSbufWriteUint8(send_buf, data))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;write send_buf fail\r\n&quot;</span>);</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line">	&#125;</span><br><span class="line">	 <span class="comment">/* 通过Dispatch发送数据到驱动，同时驱动会将数据写入reply */</span></span><br><span class="line">    <span class="type">int</span> ret = service-&gt;dispatcher-&gt;Dispatch(&amp;service-&gt;object, LED_WRITE_READ, send_buf, reply);</span><br><span class="line">	<span class="keyword">if</span>(ret != HDF_SUCCESS)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Dispatch fail\r\n&quot;</span>);</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> replyData = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//读取reply的数据</span></span><br><span class="line">	<span class="keyword">if</span> (!HdfSbufReadInt32(reply, &amp;replyData))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;fail to get service call reply!\r\n&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> out;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//回收内存</span></span><br><span class="line">out:</span><br><span class="line">    HdfSBufRecycle(send_buf);</span><br><span class="line">    HdfSBufRecycle(reply);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(argc &lt; <span class="number">2</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;error,argc &lt; 1\r\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//获取驱动提供的服务</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">HdfIoService</span> *<span class="title">service</span> =</span> HdfIoServiceBind(LED_SERVICE);</span><br><span class="line">	<span class="keyword">if</span>(service == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;fail get service %s \r\n&quot;</span>,LED_SERVICE);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//给驱动的服务发送数据</span></span><br><span class="line">	SendEvent(service,atoi(argv[<span class="number">1</span>]));</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//退订服务</span></span><br><span class="line">	HdfIoServiceRecycle(service);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;exit&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>要将my_led_app.c编译成可执行程序，并放在根文件系统。需要配置构建文件：</p>
<p>在my_led_app.c同目录下创建BUILD.gn：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import(<span class="string">&quot;//build/lite/config/component/lite_component.gni&quot;</span>)</span><br><span class="line"></span><br><span class="line">HDF_FRAMEWORKS = <span class="string">&quot;//drivers/framework&quot;</span></span><br><span class="line"></span><br><span class="line">executable(<span class="string">&quot;led_lib&quot;</span>)&#123;</span><br><span class="line">    output_name = <span class="string">&quot;my_led&quot;</span></span><br><span class="line">    sources = [ <span class="string">&quot;my_led_app.c&quot;</span> ]</span><br><span class="line">    include_dirs = [</span><br><span class="line">    <span class="string">&quot;$HDF_FRAMEWORKS/ability/sbuf/include&quot;</span>,</span><br><span class="line">    <span class="string">&quot;$HDF_FRAMEWORKS/core/shared/include&quot;</span>,</span><br><span class="line">    <span class="string">&quot;$HDF_FRAMEWORKS/core/host/include&quot;</span>,</span><br><span class="line">    <span class="string">&quot;$HDF_FRAMEWORKS/core/master/include&quot;</span>,</span><br><span class="line">    <span class="string">&quot;$HDF_FRAMEWORKS/include/core&quot;</span>,</span><br><span class="line">    <span class="string">&quot;$HDF_FRAMEWORKS/include/utils&quot;</span>,</span><br><span class="line">    <span class="string">&quot;$HDF_FRAMEWORKS/utils/include&quot;</span>,</span><br><span class="line">    <span class="string">&quot;$HDF_FRAMEWORKS/include/osal&quot;</span>,</span><br><span class="line">    <span class="string">&quot;//drivers/adapter/uhdf/posix/include&quot;</span>,</span><br><span class="line">    <span class="string">&quot;//third_party/bounds_checking_function/include&quot;</span>,</span><br><span class="line">    <span class="string">&quot;//base/hiviewdfx/hilog_lite/interfaces/native/innerkits&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">    deps = [</span><br><span class="line">        <span class="string">&quot;//base/hiviewdfx/hilog_lite/frameworks/featured:hilog_shared&quot;</span>,</span><br><span class="line">        <span class="string">&quot;//drivers/adapter/uhdf/manager:hdf_core&quot;</span>,</span><br><span class="line">        <span class="string">&quot;//drivers/adapter/uhdf/posix:hdf_posix_osal&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">    cflags_c = []</span><br><span class="line">    ldflags = []</span><br><span class="line">&#125;</span><br><span class="line">lite_component(<span class="string">&quot;my_led_app&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    features = [</span><br><span class="line">        <span class="string">&quot;:led_lib&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在build&#x2F;lite&#x2F;components&#x2F;applications.json添加如下内容，将my_led_app编译成一个组件：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">   &#123;</span><br><span class="line">      <span class="string">&quot;component&quot;</span>: <span class="string">&quot;my_sample&quot;</span>,</span><br><span class="line">      <span class="string">&quot;description&quot;</span>: <span class="string">&quot;my samples&quot;</span>,</span><br><span class="line">      <span class="string">&quot;optional&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">      <span class="string">&quot;dirs&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;applications/BearPi/BearPi-HM_Micro/samples/my_first_app&quot;</span>,</span><br><span class="line"><span class="string">&quot;applications/BearPi/BearPi-HM_Micro/samples/my_led_app&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;targets&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;//applications/BearPi/BearPi-HM_Micro/samples/my_first_app:my_app&quot;</span>,</span><br><span class="line"><span class="string">&quot;//applications/BearPi/BearPi-HM_Micro/samples/my_led_app:my_led_app&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;rom&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;ram&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;output&quot;</span>: [],</span><br><span class="line">      <span class="string">&quot;adapted_kernel&quot;</span>: [ <span class="string">&quot;liteos_a&quot;</span> ],</span><br><span class="line">      <span class="string">&quot;features&quot;</span>: [],</span><br><span class="line">      <span class="string">&quot;deps&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;components&quot;</span>: [],</span><br><span class="line">      <span class="string">&quot;third_party&quot;</span>: [ ]</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h3 id="2-3、JS应用"><a href="#2-3、JS应用" class="headerlink" title="2.3、JS应用"></a>2.3、JS应用</h3><h4 id="2-3-1、JS代码"><a href="#2-3-1、JS代码" class="headerlink" title="2.3.1、JS代码"></a>2.3.1、JS代码</h4><p>JS程序本质上也是调用了驱动程序所提供的服务来控制Led，与上一节的区别是使用的编程语言不同。JS代码通过<code>app.ledcontrol</code>来调用C++提供的接口，实际的控制逻辑由C++提供的<code>ledcontrol</code>实现。</p>
<p>首先看应用程序的JS代码：其本质就是调用ledcontrol函数，通过传递不同的参数来实现led的控制。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//灯状态 0是关闭 1是开启	2是切换</span></span><br><span class="line"><span class="keyword">var</span> led = &#123;<span class="attr">open</span>:<span class="number">1</span>,<span class="attr">close</span>:<span class="number">0</span>,<span class="attr">change</span>:<span class="number">2</span>&#125;</span><br><span class="line"><span class="keyword">import</span> app <span class="keyword">from</span> <span class="string">&#x27;@system.app&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;BearPi-HM Micro&#x27;</span>,</span><br><span class="line">        <span class="attr">statu</span>:<span class="string">&#x27;0&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">exit</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        app.<span class="title function_">terminate</span>()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">open</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> that = <span class="variable language_">this</span></span><br><span class="line">        <span class="comment">//调用ledcontrol函数、传递参数code、success、fail、complete</span></span><br><span class="line">        app.<span class="title function_">ledcontrol</span>(&#123;</span><br><span class="line">            <span class="attr">code</span>:led.<span class="property">open</span>,</span><br><span class="line">            <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">                that.<span class="property">statu</span> = res.<span class="property">led_status</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">fail</span>(<span class="params">res,code</span>)&#123;</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">complete</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">close</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> that = <span class="variable language_">this</span></span><br><span class="line">        app.<span class="title function_">ledcontrol</span>(&#123;</span><br><span class="line">            <span class="attr">code</span>:led.<span class="property">close</span>,</span><br><span class="line">            <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">                that.<span class="property">statu</span> = res.<span class="property">led_status</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">fail</span>(<span class="params">res,code</span>)&#123;</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">complete</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">change</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> that = <span class="variable language_">this</span></span><br><span class="line">        app.<span class="title function_">ledcontrol</span>(&#123;</span><br><span class="line">            <span class="attr">code</span>:led.<span class="property">change</span>,</span><br><span class="line">            <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">                that.<span class="property">statu</span> = res.<span class="property">led_status</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">fail</span>(<span class="params">res,code</span>)&#123;</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">complete</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="2-3-2、C-接口"><a href="#2-3-2、C-接口" class="headerlink" title="2.3.2、C++接口"></a>2.3.2、C++接口</h4><p>JS代码中的app.ledcontrol要能运行起来，需要C++提供对应的函数。</p>
<p>步骤如下：</p>
<p>1、在foundation\ace\ace_engine_lite\frameworks\src\core\modules\app_module.h中public声明ToggleLed函数。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">ACE_DISALLOW_COPY_AND_MOVE</span>(AppModule);</span><br><span class="line"><span class="built_in">AppModule</span>() = <span class="keyword">default</span>;</span><br><span class="line">~<span class="built_in">AppModule</span>() = <span class="keyword">default</span>;</span><br><span class="line"><span class="function"><span class="type">static</span> JSIValue <span class="title">GetInfo</span><span class="params">(<span class="type">const</span> JSIValue thisVal, <span class="type">const</span> JSIValue *args, <span class="type">uint8_t</span> argsNum)</span></span>;</span><br><span class="line"><span class="function"><span class="type">static</span> JSIValue <span class="title">Terminate</span><span class="params">(<span class="type">const</span> JSIValue thisVal, <span class="type">const</span> JSIValue *args, <span class="type">uint8_t</span> argsNum)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> JSIValue <span class="title">ToggleLed</span><span class="params">(<span class="type">const</span> JSIValue thisVal, <span class="type">const</span> JSIValue* args, <span class="type">uint8_t</span> argsNum)</span></span>;</span><br></pre></td></tr></table></figure>
<p>接着在InitAppModule()中将ToggleLed注册到JS API中，这样JS代码就能通过ledcontrol接口调用ToggleLed函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title class_">InitAppModule</span>(<span class="title class_">JSIValue</span> <span class="built_in">exports</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">JSI</span>::<span class="title class_">SetModuleAPI</span>(<span class="built_in">exports</span>, <span class="string">&quot;getInfo&quot;</span>, <span class="title class_">AppModule</span>::<span class="title class_">GetInfo</span>);</span><br><span class="line">    <span class="attr">JSI</span>::<span class="title class_">SetModuleAPI</span>(<span class="built_in">exports</span>, <span class="string">&quot;terminate&quot;</span>, <span class="title class_">AppModule</span>::<span class="title class_">Terminate</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="attr">JSI</span>::<span class="title class_">SetModuleAPI</span>(<span class="built_in">exports</span>, <span class="string">&quot;ledcontrol&quot;</span>, <span class="title class_">AppModule</span>::<span class="title class_">ToggleLed</span>);</span><br></pre></td></tr></table></figure>
<p>2、在foundation\ace\ace_engine_lite\frameworks\src\core\modules\app_module.cpp中实现ToggleLed()</p>
<p>首先添加头文件和宏定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;hdf_sbuf.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;hdf_io_service_if.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED_WRITE_READ 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED_SERVICE <span class="string">&quot;hdf_led&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>添加ToggleLed()的定义：将以下代码与2.2 LED应用程序比较、不难看出两者逻辑是相同的，差别在于C++这里需要处理success、fail、complete的回调。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">OnDevEventReceived</span><span class="params">(<span class="type">void</span> *priv, <span class="type">uint32_t</span> id, <span class="keyword">struct</span> HdfSBuf *data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> value;</span><br><span class="line">    <span class="built_in">HdfSbufReadUint32</span>(data, &amp;value);</span><br><span class="line">    <span class="built_in">HILOG_ERROR</span>(HILOG_MODULE_ACE,<span class="string">&quot;%s: dev event received: %u %u\n&quot;</span>, (<span class="type">char</span> *)priv, id, value);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HDF_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//向led驱动发送数据并返回结果</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">GpioWriteRead</span><span class="params">(<span class="keyword">struct</span> HdfIoService *serv, <span class="type">int32_t</span> eventData, <span class="type">int32_t</span> *val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = HDF_FAILURE;</span><br><span class="line">    <span class="comment">//申请内存用于和HDF驱动通信</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">HdfSBuf</span> *data = <span class="built_in">HdfSBufObtainDefaultSize</span>();</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">HdfSBuf</span> *reply = <span class="built_in">HdfSBufObtainDefaultSize</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (data == <span class="literal">NULL</span> || reply == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">HILOG_ERROR</span>(HILOG_MODULE_ACE,<span class="string">&quot;fail to obtain sbuf data\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//将eventData的数据复制到data</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">HdfSbufWriteUint8</span>(data, (<span class="type">uint8_t</span>)eventData))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">HILOG_ERROR</span>(HILOG_MODULE_ACE,<span class="string">&quot;fail to write sbuf\n&quot;</span>);</span><br><span class="line">        <span class="built_in">HdfSBufRecycle</span>(data);</span><br><span class="line">        <span class="built_in">HdfSBufRecycle</span>(reply);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//调用驱动的dispatch函数，向led驱动发送数据并接收返回结果。</span></span><br><span class="line">    ret = serv-&gt;dispatcher-&gt;<span class="built_in">Dispatch</span>(&amp;serv-&gt;object, LED_WRITE_READ, data, reply);</span><br><span class="line">    <span class="keyword">if</span> (ret != HDF_SUCCESS)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">HILOG_ERROR</span>(HILOG_MODULE_ACE,<span class="string">&quot;fail to send service call\n&quot;</span>);</span><br><span class="line">        <span class="built_in">HdfSBufRecycle</span>(data);</span><br><span class="line">        <span class="built_in">HdfSBufRecycle</span>(reply);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//读取返回结果到reply</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">HdfSbufReadInt32</span>(reply, val))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">HILOG_ERROR</span>(HILOG_MODULE_ACE,<span class="string">&quot;fail to get service call reply\n&quot;</span>);</span><br><span class="line">        ret = HDF_ERR_INVALID_OBJECT;</span><br><span class="line">        <span class="built_in">HdfSBufRecycle</span>(data);</span><br><span class="line">        <span class="built_in">HdfSBufRecycle</span>(reply);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">HILOG_ERROR</span>(HILOG_MODULE_ACE,<span class="string">&quot;Get reply is: %d\n&quot;</span>, val);</span><br><span class="line">	<span class="comment">//释放内存</span></span><br><span class="line">    <span class="built_in">HdfSBufRecycle</span>(data);</span><br><span class="line">    <span class="built_in">HdfSBufRecycle</span>(reply);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//led控制</span></span><br><span class="line"><span class="function">JSIValue <span class="title">AppModule::ToggleLed</span><span class="params">(<span class="type">const</span> JSIValue thisVal, <span class="type">const</span> JSIValue *args, <span class="type">uint8_t</span> argsNum)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">HILOG_ERROR</span>(HILOG_MODULE_ACE, <span class="string">&quot;led button pressed.&quot;</span>);</span><br><span class="line">	<span class="comment">//获取led驱动提供的服务</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">HdfIoService</span> *serv = <span class="built_in">HdfIoServiceBind</span>(LED_SERVICE);</span><br><span class="line">    <span class="keyword">if</span> (serv == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">HILOG_ERROR</span>(HILOG_MODULE_ACE,<span class="string">&quot;fail to get service2 %s\n&quot;</span>, LED_SERVICE);</span><br><span class="line">        <span class="keyword">return</span> JSI::<span class="built_in">CreateUndefined</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((args == <span class="literal">nullptr</span>) || (argsNum == <span class="number">0</span>) || (JSI::<span class="built_in">ValueIsUndefined</span>(args[<span class="number">0</span>]))) &#123;</span><br><span class="line">        <span class="keyword">return</span> JSI::<span class="built_in">CreateUndefined</span>();</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//获取JS代码中的success、fail、complete的？</span></span><br><span class="line">    JSIValue success = JSI::<span class="built_in">GetNamedProperty</span>(args[<span class="number">0</span>], CB_SUCCESS);</span><br><span class="line">    JSIValue fail = JSI::<span class="built_in">GetNamedProperty</span>(args[<span class="number">0</span>], CB_FAIL);</span><br><span class="line">    JSIValue complete = JSI::<span class="built_in">GetNamedProperty</span>(args[<span class="number">0</span>], CB_COMPLETE);</span><br><span class="line">	<span class="comment">//获取code的值，即JS代码中的 code:led.open，也就是 0、1、2控制码</span></span><br><span class="line">    <span class="type">int32_t</span> num = (<span class="type">int32_t</span>)JSI::<span class="built_in">GetNumberProperty</span>(args[<span class="number">0</span>], <span class="string">&quot;code&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int32_t</span> replyData = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//将命令发送到led驱动</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">GpioWriteRead</span>(serv, num, &amp;replyData))</span><br><span class="line">    &#123;</span><br><span class="line">    	<span class="comment">//驱动led失败、调用fail、complete函数</span></span><br><span class="line">        <span class="built_in">HILOG_ERROR</span>(HILOG_MODULE_ACE,<span class="string">&quot;fail to send event\n&quot;</span>);</span><br><span class="line">        JSI::<span class="built_in">CallFunction</span>(fail, thisVal, <span class="literal">nullptr</span>, <span class="number">0</span>);</span><br><span class="line">        JSI::<span class="built_in">CallFunction</span>(complete, thisVal, <span class="literal">nullptr</span>, <span class="number">0</span>);</span><br><span class="line">        JSI::<span class="built_in">ReleaseValueList</span>(success, fail, complete);</span><br><span class="line">        <span class="keyword">return</span> JSI::<span class="built_in">CreateUndefined</span>();</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//驱动led成功，返回结果对象</span></span><br><span class="line">    JSIValue result = JSI::<span class="built_in">CreateObject</span>();</span><br><span class="line">    <span class="comment">//设置结果对象中的led_status属性值。对应js代码中的&quot;that.statu = res.led_status&quot;</span></span><br><span class="line">    JSI::<span class="built_in">SetNumberProperty</span>(result, <span class="string">&quot;led_status&quot;</span>, replyData);</span><br><span class="line">	<span class="comment">//调用success、complete函数</span></span><br><span class="line">    JSIValue argv[ARGC_ONE] = &#123;result&#125;;</span><br><span class="line">    JSI::<span class="built_in">CallFunction</span>(success, thisVal, argv, ARGC_ONE);</span><br><span class="line">    JSI::<span class="built_in">CallFunction</span>(complete, thisVal, <span class="literal">nullptr</span>, <span class="number">0</span>);</span><br><span class="line">    JSI::<span class="built_in">ReleaseValueList</span>(success, fail, complete, result);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">HdfIoServiceRecycle</span>(serv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> JSI::<span class="built_in">CreateUndefined</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、将编写的源文件添加到编译系统。</p>
<p>首先配置HDF头文件路径：<br>在foundation\ace\ace_engine_lite\ace_lite.gni中添加HDF头文件路径</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ace_lite_include_dirs += [</span><br><span class="line">    <span class="string">&quot;//drivers/framework/ability/sbuf/include&quot;</span>,</span><br><span class="line">    <span class="string">&quot;//drivers/framework/include/core&quot;</span>,</span><br><span class="line">    <span class="string">&quot;//drivers/framework/include/utils&quot;</span>,</span><br><span class="line">    <span class="string">&quot;//drivers/adapter/uhdf/posix/include&quot;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>添加编译依赖：<br>修改foundation\ace\ace_engine_lite\frameworks\BUILD.gn，在public_deps中添加以下代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;//drivers/adapter/uhdf/manager:hdf_core&quot;</span>,</span><br></pre></td></tr></table></figure>


<p>修改foundation\ace\ace_engine_lite\test\ace_test_config.gni，在extra_deps中添加以下代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;//drivers/adapter/uhdf/manager:hdf_core&quot;</span>,</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/01/killer-blog/OpenHarmony/bear_micro_LED/" data-id="cmbcy7rho002mt8mt7c60br47" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2025/06/01/killer-blog/OpenHarmony/stm32mp157_ir_control/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2025/06/01/killer-blog/OpenHarmony/HDF_PWM_Core/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">June 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">May 2025</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/06/01/killer-blog/sifive/pwm/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/06/01/killer-blog/sifive/uart/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/06/01/killer-blog/worklife/2025%E6%B1%82%E8%81%8C%E5%87%86%E5%A4%87/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/06/01/killer-blog/other/tools/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/06/01/killer-blog/sifive/i2c_LSM303AGR/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>