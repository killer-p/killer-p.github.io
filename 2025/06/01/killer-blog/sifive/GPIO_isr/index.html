<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Sifive Learn Inventor 基础之gpio 按键中断@[toc] 系列文章 Sifive Learn Inventor 基础之gpio 按键中断 Sifive learn inventor基础之串口&amp;操作寄存器 Sifive learn inventor基础之硬件pwm&amp;寄存器 risc-v Sifive learn inventor基础之硬件i2c与LSM303A">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2025/06/01/killer-blog/sifive/GPIO_isr/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Sifive Learn Inventor 基础之gpio 按键中断@[toc] 系列文章 Sifive Learn Inventor 基础之gpio 按键中断 Sifive learn inventor基础之串口&amp;操作寄存器 Sifive learn inventor基础之硬件pwm&amp;寄存器 risc-v Sifive learn inventor基础之硬件i2c与LSM303A">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2025/05/30/hello-world/sifive/GPIO_isr/2020060616125185.png">
<meta property="og:image" content="http://example.com/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgyMTY0NA==,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="http://example.com/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgyMTY0NA==,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="http://example.com/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgyMTY0NA==,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="http://example.com/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgyMTY0NA==,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="http://example.com/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgyMTY0NA==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="http://example.com/2025/05/30/hello-world/sifive/GPIO_isr/20200606164541184.png">
<meta property="og:image" content="http://example.com/2025/05/30/hello-world/sifive/GPIO_isr/20200606165110554.png">
<meta property="og:image" content="http://example.com/2025/05/30/hello-world/sifive/GPIO_isr/20200606172139626.png">
<meta property="og:image" content="http://example.com/2025/05/30/hello-world/sifive/GPIO_isr/20200614084841413.png">
<meta property="article:published_time" content="2025-06-01T00:24:26.659Z">
<meta property="article:modified_time" content="2025-06-01T00:26:26.792Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2025/05/30/hello-world/sifive/GPIO_isr/2020060616125185.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-killer-blog/sifive/GPIO_isr" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/01/killer-blog/sifive/GPIO_isr/" class="article-date">
  <time class="dt-published" datetime="2025-06-01T00:24:26.659Z" itemprop="datePublished">2025-06-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Sifive-Learn-Inventor-基础之gpio-按键中断"><a href="#Sifive-Learn-Inventor-基础之gpio-按键中断" class="headerlink" title="Sifive Learn Inventor 基础之gpio 按键中断"></a>Sifive Learn Inventor 基础之gpio 按键中断</h2><p>@[toc]</p>
<h2 id="系列文章"><a href="#系列文章" class="headerlink" title="系列文章"></a>系列文章</h2><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44821644/article/details/106589242">Sifive Learn Inventor 基础之gpio 按键中断</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44821644/article/details/106603894">Sifive learn inventor基础之串口&amp;操作寄存器</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44821644/article/details/106631404">Sifive learn inventor基础之硬件pwm&amp;寄存器</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44821644/article/details/106796337">risc-v Sifive learn inventor基础之硬件i2c与LSM303AGR通信</a></li>
</ol>
<blockquote>
<p>Sifive Learn Inventor是Sifive的一款基于RISC-V内核的开发板，具体见官网的Hifive Rev b 的文档</p>
</blockquote>
<h2 id="一，硬件连接"><a href="#一，硬件连接" class="headerlink" title="一，硬件连接"></a>一，硬件连接</h2><p>芯片的gpio11连接到buttonA，如下，可见，按键按下是低电平，所以我们可以设置gpio11为下降沿中断来实现按键中断。<br><img src="/2025/05/30/hello-world/sifive/GPIO_isr/2020060616125185.png" alt="在这里插入图片描述"><br><img src="/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgyMTY0NA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="二，代码编写"><a href="#二，代码编写" class="headerlink" title="二，代码编写"></a>二，代码编写</h2><ol>
<li>首先是button初始化</li>
</ol>
<p>​&#96;&#96;&#96;c<br>&#x2F;**<br>*buttona初始化为下降沿触发中断<br>*&#x2F;<br>void ButtonA_init(int *flag)<br>{<br>	<br>	struct metal_gpio *gpio0;&#x2F;&#x2F;声明一个gpio对象<br>	int buttonA_id&#x3D;12;&#x2F;&#x2F;根据芯片手册查询到gpio11的中断id的为12<br>	gpio0&#x3D;metal_gpio_get_device(0);&#x2F;&#x2F;实例化gpio对象</p>
<pre><code>//获得gpio控制器，其实就是plic
buttonA_intr=metal_gpio_interrupt_controller(gpio0);

metal_interrupt_init(buttonA_intr);

//注册回调函数 buttonA_isr是回调函数的函数名，最后传递的flag是一个指针，是传递给回调函数的参数
metal_interrupt_register_handler(buttonA_intr,buttonA_id,buttonA_isr,flag);
//设置优先级为3
metal_interrupt_set_priority(buttonA_intr,buttonA_id,3);

//enable gpio
metal_gpio_disable_output(gpio0,11);
metal_gpio_enable_input(gpio0,11);

//禁止gpio功能复用
metal_gpio_disable_pinmux(gpio0,11);

//先关闭一下中断
metal_gpio_config_interrupt(gpio0,11,METAL_GPIO_INT_DISABLE);

//清楚gpio中断的所有标志位
metal_gpio_clear_interrupt(gpio0,11, METAL_GPIO_INT_MAX);

//配置为下降沿中断
metal_gpio_config_interrupt(gpio0,11,METAL_GPIO_INT_FALLING);

//使能gpio11 
metal_interrupt_enable(buttonA_intr,buttonA_id);
</code></pre>
<p>}<br>​&#96;&#96;&#96;</p>
<p>2，中断服务函数中，改变全局变量flag的值，随后在主函数中判断flag的值，再进入处理函数；<br>这里的中断函数的名称是可以随意取的，但是传递的参数必须是固定的int id, void <em>data，void</em>data 是由初始化注册回调函数的传递过来的无类型的一个指针。在回调函数中，先拿到gpio对象，然后清楚gpio11的下降沿中断的标志位。然后从data里拿到flag的地址，从而改变flag的值。</p>
<p>​<code>c /** *buttona回调函数 清除下降沿中断标志位，将flag置2 */ void buttonA_isr (int id, void *data)&#123; 	struct metal_gpio *gpio0=metal_gpio_get_device(0); 	metal_gpio_clear_interrupt(gpio0, 11,METAL_GPIO_INT_FALLING); 	int *flag=(int *)data; 	*flag=2; &#125; ​</code></p>
<p>3，在main（）函数中检测flag的值</p>
<p>​<code>c while(1)&#123; 	if(flag==2)&#123; 		fun(); 	&#125; &#125; ​</code></p>
<h2 id="三，小结"><a href="#三，小结" class="headerlink" title="三，小结"></a>三，小结</h2><p> <strong>这是一个简单的gpio中断的配置，从这个例子出发，来讨论一下sifive的中断是如何完成的。然后就可以依样画葫芦，其他外设的中断也可以相对容易的去理解。</strong><br> 中断产生的过程大概是这样的：<br> <img src="/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgyMTY0NA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>inturrpt就是我们的中断源，当我们的按键按下时，gpio11就产生了一个中断请求，中断信号先来到plic控制器，plic根据请求的优先级来给中断请求排队，根据中断的id来找到中断服务程序的入口，随后进入中断服务函数，当完成中断服务函数后，plic相应的id的中断标志位会被置0</strong><br><strong>根据手册可以知道plic负责管理所有外设的中断请求，从下表可以知道外设对应的中断id。</strong><br><strong>其实上面代码中的buttonA_intr&#x3D;metal_gpio_interrupt_controller(gpio0);这个函数就是把plic控制器的对象负责给buttonA_intr，这样通过操作buttonA_intr，其实也就是对plic的操作。</strong><br><img src="/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgyMTY0NA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>综上，要初始化一个外设中断，我们需要配置外设的中断寄存器，同时还要拿到plic对象，中断id，接下来就是配置plic，设置回调函数和中断优先级。这时候再来看初始化代码</strong></p>
<p>这两个语句就是获取中断id和plic；</p>
<blockquote>
<p>int buttonA_id&#x3D;12;<br>buttonA_intr&#x3D;metal_gpio_interrupt_controller(gpio0);</p>
</blockquote>
<p>初始化一下plic，主要是把plic对象里的一些参数赋值为0或null</p>
<blockquote>
<p>metal_interrupt_init(buttonA_intr);</p>
</blockquote>
<p>这个函数就是配置plic的作用，在plic的中断表里id&#x3D;12的地方写入中断回调函数的地址和传递的参数</p>
<blockquote>
<p>metal_interrupt_register_handler(buttonA_intr,buttonA_id,buttonA_isr,flag);</p>
</blockquote>
<p>设置一下优先级，使能这个中断</p>
<blockquote>
<p>metal_interrupt_set_priority(buttonA_intr,buttonA_id,3);<br>metal_interrupt_enable(buttonA_intr,buttonA_id);</p>
</blockquote>
<p><strong>至此，一个中断初始化的plic部分就设置完成了，另一部分，外设的中断寄存器配置就要根据手册的说明或者库函数去相应的配置</strong><br>可以根据下面的图片理解plic，其实初始化一个外设中断就像是给下面的表格填写对应的内容，我们需要的就是plic对象，id，回调函数地址，优先级，传递参数。更多的plic内容查看芯片手册。<br><img src="/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgyMTY0NA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgyMTY0NA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## Sifive Learn Inventor 基础之gpio 按键中断</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 文章目录</span><br><span class="line"></span><br><span class="line">- - [Sifive Learn Inventor 基础之gpio 按键中断](https://editor.csdn.net/md/?articleId=106589242#Sifive_Learn_Inventor_gpio__0)</span><br><span class="line">  - [系列文章](https://editor.csdn.net/md/?articleId=106589242#_2)</span><br><span class="line">  - [一，硬件连接](https://editor.csdn.net/md/?articleId=106589242#_9)</span><br><span class="line">  - [二，代码编写](https://editor.csdn.net/md/?articleId=106589242#_13)</span><br><span class="line">  - [三，小结](https://editor.csdn.net/md/?articleId=106589242#_79)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 系列文章</span><br><span class="line"></span><br><span class="line">1. [Sifive Learn Inventor 基础之gpio 按键中断](https://blog.csdn.net/weixin_44821644/article/details/106589242)</span><br><span class="line">2. [Sifive learn inventor基础之串口&amp;操作寄存器](https://blog.csdn.net/weixin_44821644/article/details/106603894)</span><br><span class="line">3. [Sifive learn inventor基础之硬件pwm&amp;寄存器](https://blog.csdn.net/weixin_44821644/article/details/106631404)</span><br><span class="line">4. [risc-v Sifive learn inventor基础之硬件i2c与LSM303AGR通信](https://blog.csdn.net/weixin_44821644/article/details/106796337)</span><br><span class="line"></span><br><span class="line">&gt; Sifive Learn Inventor是Sifive的一款基于RISC-V内核的开发板，具体见官网的Hifive Rev b 的文档</span><br><span class="line"></span><br><span class="line">## 一，硬件连接</span><br><span class="line"></span><br><span class="line">芯片的gpio11连接到buttonA，如下，可见，按键按下是低电平，所以我们可以设置gpio11为下降沿中断来实现按键中断。</span><br><span class="line">![在这里插入图片描述](2020060616125185.png)</span><br><span class="line">![在这里插入图片描述](20200606161214498.png)</span><br><span class="line"></span><br><span class="line">## 二，代码编写</span><br><span class="line"></span><br><span class="line">1. 首先是button初始化</span><br><span class="line"></span><br><span class="line">```c</span><br><span class="line">/**</span><br><span class="line">*buttona初始化为下降沿触发中断</span><br><span class="line">*/</span><br><span class="line">void ButtonA_init(int *flag)</span><br><span class="line">&#123;</span><br><span class="line">	</span><br><span class="line">	struct metal_gpio *gpio0;//声明一个gpio对象</span><br><span class="line">	int buttonA_id=12;//根据芯片手册查询到gpio11的中断id的为12</span><br><span class="line">	gpio0=metal_gpio_get_device(0);//实例化gpio对象</span><br><span class="line"></span><br><span class="line">	//获得gpio控制器，其实就是plic</span><br><span class="line">	buttonA_intr=metal_gpio_interrupt_controller(gpio0);</span><br><span class="line">	</span><br><span class="line">	metal_interrupt_init(buttonA_intr);</span><br><span class="line"></span><br><span class="line">	//注册回调函数 buttonA_isr是回调函数的函数名，最后传递的flag是一个指针，是传递给回调函数的参数</span><br><span class="line">	metal_interrupt_register_handler(buttonA_intr,buttonA_id,buttonA_isr,flag);</span><br><span class="line">	//设置优先级为3</span><br><span class="line">	metal_interrupt_set_priority(buttonA_intr,buttonA_id,3);</span><br><span class="line">	</span><br><span class="line">	//enable gpio</span><br><span class="line">	metal_gpio_disable_output(gpio0,11);</span><br><span class="line">	metal_gpio_enable_input(gpio0,11);</span><br><span class="line">	</span><br><span class="line">	//禁止gpio功能复用</span><br><span class="line">	metal_gpio_disable_pinmux(gpio0,11);</span><br><span class="line">	</span><br><span class="line">	//先关闭一下中断</span><br><span class="line">	metal_gpio_config_interrupt(gpio0,11,METAL_GPIO_INT_DISABLE);</span><br><span class="line">	</span><br><span class="line">	//清楚gpio中断的所有标志位</span><br><span class="line">	metal_gpio_clear_interrupt(gpio0,11, METAL_GPIO_INT_MAX);</span><br><span class="line"></span><br><span class="line">	//配置为下降沿中断</span><br><span class="line">	metal_gpio_config_interrupt(gpio0,11,METAL_GPIO_INT_FALLING);</span><br><span class="line"></span><br><span class="line">	//使能gpio11 </span><br><span class="line">	metal_interrupt_enable(buttonA_intr,buttonA_id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2，中断服务函数中，改变全局变量flag的值，随后在主函数中判断flag的值，再进入处理函数；<br>这里的中断函数的名称是可以随意取的，但是传递的参数必须是固定的int id, void <em>data，void</em>data 是由初始化注册回调函数的传递过来的无类型的一个指针。在回调函数中，先拿到gpio对象，然后清楚gpio11的下降沿中断的标志位。然后从data里拿到flag的地址，从而改变flag的值。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*buttona回调函数 清除下降沿中断标志位，将flag置2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">buttonA_isr</span> <span class="params">(<span class="type">int</span> id, <span class="type">void</span> *data)</span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">metal_gpio</span> *<span class="title">gpio0</span>=</span>metal_gpio_get_device(<span class="number">0</span>);</span><br><span class="line">	metal_gpio_clear_interrupt(gpio0, <span class="number">11</span>,METAL_GPIO_INT_FALLING);</span><br><span class="line">	<span class="type">int</span> *flag=(<span class="type">int</span> *)data;</span><br><span class="line">	*flag=<span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3，在main（）函数中检测flag的值</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(flag==<span class="number">2</span>)&#123;</span><br><span class="line">		fun();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三，小结-1"><a href="#三，小结-1" class="headerlink" title="三，小结"></a>三，小结</h2><p><strong>这是一个简单的gpio中断的配置，从这个例子出发，来讨论一下sifive的中断是如何完成的。然后就可以依样画葫芦，其他外设的中断也可以相对容易的去理解。</strong><br>中断产生的过程大概是这样的：<br><img src="/2025/05/30/hello-world/sifive/GPIO_isr/20200606164541184.png" alt="在这里插入图片描述"><br><strong>inturrpt就是我们的中断源，当我们的按键按下时，gpio11就产生了一个中断请求，中断信号先来到plic控制器，plic根据请求的优先级来给中断请求排队，根据中断的id来找到中断服务程序的入口，随后进入中断服务函数，当完成中断服务函数后，plic相应的id的中断标志位会被置0</strong><br><strong>根据手册可以知道plic负责管理所有外设的中断请求，从下表可以知道外设对应的中断id。</strong><br><strong>其实上面代码中的buttonA_intr&#x3D;metal_gpio_interrupt_controller(gpio0);这个函数就是把plic控制器的对象负责给buttonA_intr，这样通过操作buttonA_intr，其实也就是对plic的操作。</strong><br><img src="/2025/05/30/hello-world/sifive/GPIO_isr/20200606165110554.png" alt="在这里插入图片描述"><br><strong>综上，要初始化一个外设中断，我们需要配置外设的中断寄存器，同时还要拿到plic对象，中断id，接下来就是配置plic，设置回调函数和中断优先级。这时候再来看初始化代码</strong></p>
<p>这两个语句就是获取中断id和plic；</p>
<blockquote>
<p>int buttonA_id&#x3D;12;<br>buttonA_intr&#x3D;metal_gpio_interrupt_controller(gpio0);</p>
</blockquote>
<p>初始化一下plic，主要是把plic对象里的一些参数赋值为0或null</p>
<blockquote>
<p>metal_interrupt_init(buttonA_intr);</p>
</blockquote>
<p>这个函数就是配置plic的作用，在plic的中断表里id&#x3D;12的地方写入中断回调函数的地址和传递的参数</p>
<blockquote>
<p>metal_interrupt_register_handler(buttonA_intr,buttonA_id,buttonA_isr,flag);</p>
</blockquote>
<p>设置一下优先级，使能这个中断</p>
<blockquote>
<p>metal_interrupt_set_priority(buttonA_intr,buttonA_id,3);<br>metal_interrupt_enable(buttonA_intr,buttonA_id);</p>
</blockquote>
<p><strong>至此，一个中断初始化的plic部分就设置完成了，另一部分，外设的中断寄存器配置就要根据手册的说明或者库函数去相应的配置</strong><br>可以根据下面的图片理解plic，其实初始化一个外设中断就像是给下面的表格填写对应的内容，我们需要的就是plic对象，id，回调函数地址，优先级，传递参数。更多的plic内容查看芯片手册。<br><img src="/2025/05/30/hello-world/sifive/GPIO_isr/20200606172139626.png" alt="在这里插入图片描述"><br><img src="/2025/05/30/hello-world/sifive/GPIO_isr/20200614084841413.png" alt="在这里插入图片描述"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/01/killer-blog/sifive/GPIO_isr/" data-id="cmbcy7ri0003st8mt4kxkag1u" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2025/06/01/killer-blog/sifive/i2c_LSM303AGR/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2025/06/01/killer-blog/other/ringbuff_c_impl/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">June 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">May 2025</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/06/01/killer-blog/sifive/pwm/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/06/01/killer-blog/sifive/uart/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/06/01/killer-blog/worklife/2025%E6%B1%82%E8%81%8C%E5%87%86%E5%A4%87/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/06/01/killer-blog/other/tools/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/06/01/killer-blog/sifive/i2c_LSM303AGR/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>